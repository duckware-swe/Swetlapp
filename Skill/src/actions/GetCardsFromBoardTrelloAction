const { Action } = require('./Action.js');
const Trello = require("trello");

var apiKey = '77b62a6bf6bde24b95bd2f7d28d7b226';
var token = 'a1a5b837de41f33a97f27b8afc716f0dbd0a8db35d51c77cafe95a1db9fdd333';


/**
 * See link trello developers: https://developers.trello.com
 * For example we can use the following url: 'https://api.trello.com/1/boards/{boardId}/?cards=all' to get all cards in a board
 *
 * Riferimenti alla pagina: https://www.npmjs.com/package/trello
 *
 * To get Api Key follow: https://trello.com/app-key
 * To get token key just click on the link 'puoi generare un Token manualmente'. It is near the section where there is the Api Key
 *
 * @type {{}}
 */

var exports = module.exports = {};

class GetCardsFromBoardTrelloAction extends Action {

    constructor(name, params) {
        super(name, params);
    }

    /**
     * TODO
     *
     *  TODO
     *
     * @returns {Promise<string>} TODO
     */
    async run() {
        let output = '';
        //let body = this.params[0];
        let trello = new Trello(apiKey, token);
        let myListId = '5ca6817e91267628b5af5922'; //Id of the list where to add the card.. to be pulled from the parameters on Dynamo Db
        let boardId = '5ca6817e46cec324aeed2dc9';

        let promiseGetCardsOnBoard = () => {
            return new Promise(function (resolve, reject) {
                trello.getCardsOnBoard(boardId, function (error, data) {
                    if (error) {
                        console.log('errore - getCardsOnBoard: ',error);
                        reject('Impossibile leggere le schede');
                    }
                    else {
                        console.log('ho le schede getCardsOnBoard: ', data);
                        resolve('scheda 1 si chiama :'+data[0].name);
                    }
                });
            });
        };

        //it is possible to use await
        try{
            output = await promiseGetCardsOnBoard();
        }catch (error) {
            output = error;
        }

        return output;

    }
}

exports.GetCardsFromBoardTrelloAction = GetCardsFromBoardTrelloAction;